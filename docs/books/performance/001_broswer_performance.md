# 浏览器的性能优化方案

::: tip
以下内容包括：网络优化策略，关键渲染路径，静态文件优化，具体考虑方向
:::

## 1、网络优化策略
- 1、减少Http请求数，合并JS,CSS合理内嵌CSS,JS
- 2、合理设置服务端缓存，提高服务器处理速度，（强制缓存exprie/cache-control，协商缓存Etag/if-none-match/ last-modified/if-modified-since）
- 3、避免重定向，避免重定向降低响应速度（301，302）
- 4、使用dns-prefetch，进行DNS预解析
- 5、采用域名分片技术，将资源放在不同域名下，因为同一个域名下最多处理6个TCP连接
- 6、采用CDN加速访问速度，指派最近，高度可用。
- 7、使用gzip压缩优化，对传输资源进行体积压缩
- 8、加载数据优先级：preload(预先请求当前页面需要的资源)，prefetch(将来页面中使用的资源)，将数据缓存到Http缓存里。

## 2、关键渲染路径
渲染路径包括：js => 样式计算 => 布局 => 绘制 => 合成；重排（回流），增删元素，修改大小，获取位置信息和移动元素位置都会触发；重绘：在页面元素样式改变并不影响它在文档流的位置
- 1、强制同步布局问题：js强制将计算样式和布局操作提前至当前的任务中
- 2、布局抖动问题：js内反复执行布局操作就会导致这个问题
- 3、减少回流和重绘

    - 1、脱离文档流
    - 2、渲染时给图片添加固定的宽高
    - 3、尽量使用css3动画
    - 4、可使用will-change提取到单独的图层中

## 3、静态文件优化
 - 1、图片优化
  - 图片格式优化：
      - jpg 适合色彩丰富的图片，不适合图形文字和图标
      - jpng:适合纯色，透明、图标，不适合丰富的色彩，体积较大
      - jwebp:适合半透明图片，可保证图片质量和较小的体积
  - 图片优化：
      - 1、避免空src图片
      - 2、减小图片的尺寸，节省用户流量
      - 3、img标签要设置alt属性，提升加载失败时的用户体验
      - 4、图片懒加载（原生的loading:lazy，intersectionObserver）
      - 5、不同环境下加载不同尺寸的像素的图片，设置size属性，
      - 6、对于较大的图片考虑渐进式图片
      - 7、采用base64URL 减少图片请求
      - 8、还能使用雪碧图合并图标图片

- 2、HTML优化 
  - 1、语义化HTML代码简洁清晰，利于搜索引擎和团队开发
  - 2、提前声明字符编码，让浏览器快速确定如何渲染网页内容
  - 3、减少HTML嵌套关系，减少DOM节点数量
  - 4、删除多余空格、空行、注释、和无用的属性
  - 5、HMLT减少iframes（iframe 会阻塞onload事件，可动态加载iframe）

- 3、CSS 优化
 - 1、减少伪类选择器（会导致回流），减少样式层数，减少使用通配符
 - 2、避免使用css表达式
 - 3、避免空行、注释、减少无意义的单位，对css进行压缩
 - 4、使用外链CSS,对CSS进行缓存
 - 5、添加媒体字段，只加载有效CSS文件
 - 6、减少@import使用，因为@import采用串行加载  
 
 - 4、JS 优化
  - 1、async、defer异步加载文件
  - 2、减少DOM操作，缓存访问过的元素
  - 3、如果想操作DOM，可先应用到虚拟DOM上，最后在一次性的应用到DOM上。
  - 4、可使用webworker解决程序阻塞问题
  - 5、虚拟滚动（固定一个视口，知道固定元素的宽高，只选视口内的元素）
  - 6、动画多采用requestAnimationFrame，然后可用requestIdleCallback 空闲时间执行（settimeout和setinterval会丢帧的情况）
  - 7、尽量避免使用eval，消耗时间久
  - 8、使用事件委托，减少事件绑定个数

 - 5、字体优化
  - @font-face,在字体未加载完成，可加载默认字体

## 具体问题考虑

- 1、关键资源的个数问题，越少则下载时间短
- 2、优化白屏，内联CSS和内联JS，移除文件下载，减少文件体积
- 3、预渲染，打包时进行预渲染
- 4、使用SSR，会耗费服务器资源，有利于SEO,首屏更快

